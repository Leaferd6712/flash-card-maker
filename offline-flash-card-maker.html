<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Flashcard Maker</title>
  <style>
    :root{
      --page-margin-mm: 10mm;
      --page-width-mm: 210mm;
      --page-height-mm: 297mm;
      --card-gap-mm: 4mm;
      --card-padding-mm: 4mm;
      --ui-accent: #2a9d8f;
      --font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    body{font-family:var(--font-family);margin:0;background:#f3f6f8;color:#111}
    header{display:flex;justify-content:space-between;align-items:flex-start;padding:12px 16px;background:linear-gradient(0deg,#ffffffaa,#ffffffaa);gap:12px}
    h1{font-size:18px;margin:0}
    .subtitle{font-size:13px;color:#444}

    /* Controls */
    .controls{display:flex;flex-direction:column;gap:10px;min-width:320px}
    textarea{width:100%;min-height:140px;padding:8px;font-size:14px;border:1px solid #ddd;border-radius:6px}
    .row{display:flex;gap:8px;align-items:center}
    label{font-size:13px}
    select,input[type=number]{padding:6px;border:1px solid #ddd;border-radius:6px}
    button, a.button-link{padding:8px 12px;border-radius:8px;border:none;background:var(--ui-accent);color:white;cursor:pointer;text-decoration:none;display:inline-flex;align-items:center;justify-content:center}
    button.ghost, a.button-link.ghost{background:white;color:var(--ui-accent);border:1px solid var(--ui-accent)}
    .small{font-size:12px;color:#444}

    main{display:flex;gap:16px;padding:12px}
    .left{flex:1;max-width:720px}
    .right{width:520px}

    /* Preview cards */
    .previewBox{background:white;padding:10px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.06)}
    .pagePreview{width:210mm;height:297mm;border:1px solid #e6e6e6;margin:8px 0;overflow:hidden}

    /* printable grid */
    .printPage{width:210mm;height:297mm;padding:var(--page-margin-mm);background:white}
    .cardsGrid{display:grid;gap:var(--card-gap-mm);height:100%}
    .card{border:0.8pt dashed rgba(0,0,0,0.08);border-radius:4px;padding:var(--card-padding-mm);display:flex;align-items:center;justify-content:center;text-align:center;overflow:hidden;position:relative}
    .card .meta{position:absolute;left:4px;top:4px;font-size:10px;color:rgba(0,0,0,0.45)}
    .card .text{width:100%;height:100%;display:flex;align-items:center;justify-content:center;padding:4px;word-wrap:break-word}

    /* hide UI when printing */
    .no-print{display:block}
    @media print{
      body{background:white}
      .no-print{display:none !important}
      .pagePreview, header, main > .right{display:none}
      .printWrapper{display:block}
      @page { size: A4; margin: 0mm }
    }

    /* helpful messages */
    .msg{padding:8px;border-radius:6px;background:#fff3cd;color:#664d03;border:1px solid #ffeeba}
    .error{padding:8px;border-radius:6px;background:#f8d7da;color:#721c24;border:1px solid #f5c6cb}

    /* responsive */
    @media (max-width:1100px){ main{flex-direction:column} .right{width:100%} }
  </style>
</head>
<body>
  <header class="no-print">
    <div>
      <h1>Flashcard Maker</h1>
      <div class="subtitle">Paste pairs like <code>desert: a dry place</code> (one per line). Definitions appear on separate pages in the generated PDF. Use <strong>Save as PDF</strong> in the print dialog.</div>
    </div>
    <div class="small">Press download app file to use the flash card maker offline without internet!</div>
  </header>

  <main>
    <section class="left no-print">
      <div class="controls previewBox">
        <label for="inputArea"><strong>Vocabulary Input (one pair per line)</strong></label>
        <textarea id="inputArea" placeholder="e.g. desert: a dry place\nriver: flowing water"></textarea>
        <div class="row" style="margin-top:8px;flex-wrap:wrap">
          <label>Cards per page:</label>
          <select id="cardsPerPage">
            <option value="4">4 (2×2)</option>
            <option value="8" selected>8 (2×4)</option>
            <option value="12">12 (3×4)</option>
            <option value="16">16 (4×4)</option>
          </select>

          <label><input id="shuffleDefs" type="checkbox" /> ?</label>
          <label><input id="showCut" type="checkbox" checked /> Show cut guides</label>
          <label><input id="addNumber" type="checkbox" /> Add index numbers</label>
        </div>

        <div class="row" style="margin-top:8px">
          <button id="generateBtn">Generate preview</button>
          <button id="printBtn" class="ghost">Save as PDF (Print)</button>
          <button id="exampleBtn" class="ghost">Load example</button>
          <button id="clearBtn" class="ghost">Clear</button>

          <!-- New download button: place offline-flash-card-maker.html beside other controls.
               Put the file "offline-flash-card-maker.html" in the same folder as this file. -->
          <a id="downloadBtn" class="button-link ghost" href="offline-flash-card-maker.html" download="offline-flash-card-maker.html" style="margin-left:6px;" role="button" title="Download offline-flash-card-maker.html">Download app file</a>
        </div>

        <div id="status" style="margin-top:8px"></div>
      </div>

      <div style="margin-top:12px" class="previewBox no-print">
        <strong>Tips</strong>
        <ul style="margin:6px 0 0 18px">
          <li>Use <strong>A4</strong> paper size and <strong>scale 100%</strong> when saving to PDF.</li>
          <li>Turn off headers/footers in your print dialog for best results.</li>
        </ul>


        
        <strong>Video Instructions</strong>


         <!-- Your video goes here -->
  <video controls width="650" style="margin-top:10px;">
    <source src="video.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>

      </div>
    </section>

    <aside class="right no-print">
      <div class="previewBox">
        <h3 style="margin:6px 0">Preview — First Terms Page</h3>
        <div id="termsPreview" class="pagePreview"></div>

        <h3 style="margin:6px 0">Preview — First Definitions Page</h3>
        <div id="defsPreview" class="pagePreview"></div>
      </div>
    </aside>
  </main>

  <!-- printable area (hidden from screen, shown only on printing) -->
  <div id="printWrapper" class="printWrapper" style="display:none"></div>

  <script>
    // Utility: parse pairs robustly, check each line
    function parsePairs(text){
      const lines = text.split(/\r?\n/);
      const pairs = [];
      const errors = [];
      lines.forEach((raw, i)=>{
        const line = raw.trim();
        if(!line) return; // skip blanks
        // Accept : , ; \t as separators, prefer first occurrence
        const m = line.match(/^(.+?)(:|,|;|\t)(.*)$/);
        if(m){
          const term = m[1].trim();
          const def = m[3].trim();
          pairs.push({term,def});
        } else {
          // treat whole line as term with empty definition, but warn
          pairs.push({term:line,def:''});
          errors.push({line:i+1,text:line});
        }
      });
      return {pairs,errors};
    }

    function clear(el){ while(el.firstChild) el.removeChild(el.firstChild); }

    // Create a single A4 print page element with grid (cols x rows)
    function createPrintPage(cols, rows, showCut){
      const page = document.createElement('div');
      page.className = 'printPage';
      const grid = document.createElement('div');
      grid.className = 'cardsGrid';
      grid.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
      grid.style.gridTemplateRows = `repeat(${rows}, 1fr)`;
      page.appendChild(grid);
      if(!showCut) grid.classList.add('no-cut');
      return {page,grid};
    }

    function makeCard(text, index, showIndex){
      const c = document.createElement('div'); c.className = 'card';
      const meta = document.createElement('div'); meta.className='meta';
      if(showIndex) meta.textContent = index+1;
      c.appendChild(meta);
      const t = document.createElement('div'); t.className='text'; t.textContent = text;
      c.appendChild(t);
      return c;
    }

    // Auto-fit: reduce font-size until fits within the card
    function autoFitText(node){
      const el = node;
      let fs = 28; el.style.fontSize = fs + 'px'; el.style.lineHeight='1.05';
      const parent = el.parentElement;
      let iter = 0;
      while((el.scrollHeight > parent.clientHeight || el.scrollWidth > parent.clientWidth) && fs > 8 && iter < 200){
        fs -= 1; el.style.fontSize = fs + 'px'; iter++;
      }
      if(fs < 9) el.style.fontSize = '9px';
    }

    function autoFitAll(container){
      const texts = container.querySelectorAll('.text');
      texts.forEach(t => autoFitText(t));
    }

    function shuffleArray(a){ const arr = a.slice(); for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]];} return arr }

    // Build pages for terms and definitions and return as a new element (not the global printWrapper)
    function buildPrintDocument(pairs, opts){
      const perPage = opts.cardsPerPage; let cols=2, rows=4;
      if(perPage===4){cols=2;rows=2} else if(perPage===8){cols=2;rows=4} else if(perPage===12){cols=3;rows=4} else if(perPage===16){cols=4;rows=4}

      const total = pairs.length;
      const pages = Math.max(1, Math.ceil(total/perPage));

      // Create a wrapper element that will be appended to the hidden printWrapper in DOM
      const wrapper = document.createElement('div');
      wrapper.style.display = 'block';

      // Prepare definitions order
      const defs = pairs.map(p=>p.def || '');
      const defsOrdered = opts.shuffleDefs ? shuffleArray(defs) : defs.slice();

      // pad pairs and defs to complete pages
      const paddedPairs = pairs.slice(); while(paddedPairs.length < pages*perPage) paddedPairs.push({term:'',def:''});
      const paddedDefs = defsOrdered.slice(); while(paddedDefs.length < pages*perPage) paddedDefs.push('');

      // For each page create terms page then definitions page
      for(let pg=0; pg<pages; pg++){
        const {page:termsPage, grid:termsGrid} = createPrintPage(cols, rows, opts.showCut);
        for(let i=0;i<perPage;i++){
          const idx = pg*perPage + i;
          const pair = paddedPairs[idx] || {term:'',def:''};
          termsGrid.appendChild(makeCard(pair.term, idx, opts.addNumber));
        }
        wrapper.appendChild(termsPage);

        const {page:defsPage, grid:defsGrid} = createPrintPage(cols, rows, opts.showCut);
        for(let i=0;i<perPage;i++){
          const idx = pg*perPage + i;
          const defText = paddedDefs[idx] || '';
          defsGrid.appendChild(makeCard(defText, idx, opts.addNumber));
        }
        wrapper.appendChild(defsPage);
      }

      // After DOM insertion we will set explicit sizes for cards so printing is accurate, and run auto-fit
      setTimeout(()=>{
        const pageMargin = 10; // mm
        const pageW = 210, pageH = 297;
        const usableW = pageW - pageMargin*2;
        const usableH = pageH - pageMargin*2;
        const gap = 4; // mm

        const allPages = wrapper.querySelectorAll('.printPage');
        allPages.forEach(pgEl => {
          // determine cols and rows from grid styles
          const grid = pgEl.querySelector('.cardsGrid');
          // extract number of columns/rows from style, fallback to opts
          const colsCount = (grid.style.gridTemplateColumns.match(/repeat\((\d+)/) || [])[1] ? parseInt(grid.style.gridTemplateColumns.match(/repeat\((\d+)/)[1]) : cols;
          const rowsCount = (grid.style.gridTemplateRows.match(/repeat\((\d+)/) || [])[1] ? parseInt(grid.style.gridTemplateRows.match(/repeat\((\d+)/)[1]) : rows;
          const cardW = (usableW - gap*(colsCount-1))/colsCount;
          const cardH = (usableH - gap*(rowsCount-1))/rowsCount;
          const cards = pgEl.querySelectorAll('.card');
          cards.forEach(c=>{
            c.style.width = `${cardW}mm`;
            c.style.height = `${cardH}mm`;
          });
        });

        // Auto-fit text on all pages inside wrapper
        autoFitAll(wrapper);
      }, 60);

      return wrapper;
    }

    // Render preview: only first page each
    function renderPreview(pairs, opts){
      const perPage = opts.cardsPerPage; let cols=2, rows=4;
      if(perPage===4){cols=2;rows=2} else if(perPage===8){cols=2;rows=4} else if(perPage===12){cols=3;rows=4} else if(perPage===16){cols=4;rows=4}
      const termsPreview = document.getElementById('termsPreview'); clear(termsPreview);
      const defsPreview = document.getElementById('defsPreview'); clear(defsPreview);

      const {page:tp, grid:tg} = createPrintPage(cols, rows, opts.showCut);
      for(let i=0;i<perPage;i++){
        const pair = pairs[i] || {term:'',def:''};
        tg.appendChild(makeCard(pair.term, i, opts.addNumber));
      }

      const defs = pairs.map(p=>p.def||'');
      const defsOrdered = opts.shuffleDefs ? shuffleArray(defs) : defs.slice();
      const {page:dp, grid:dg} = createPrintPage(cols, rows, opts.showCut);
      for(let i=0;i<perPage;i++){
        dg.appendChild(makeCard(defsOrdered[i]||'', i, opts.addNumber));
      }

      termsPreview.appendChild(tp);
      defsPreview.appendChild(dp);
      setTimeout(()=>{ autoFitAll(tp); autoFitAll(dp); }, 60);
    }

    // Main generate function with manual line checks and error reporting
    function generate(){
      try{
        const input = document.getElementById('inputArea').value;
        const parsed = parsePairs(input);
        const status = document.getElementById('status'); clear(status);
        if(parsed.errors && parsed.errors.length>0){
          const msg = document.createElement('div'); msg.className='msg';
          msg.innerHTML = `Warning: ${parsed.errors.length} line(s) had no separator and were added as terms with empty definitions (lines: ${parsed.errors.map(e=>e.line).join(', ')}).`;
          status.appendChild(msg);
        }
        if(parsed.pairs.length === 0){
          const err = document.createElement('div'); err.className='error'; err.textContent = 'No valid pairs found. Please paste at least one "term: definition" line.'; status.appendChild(err); return;
        }

        const opts = {
          cardsPerPage: parseInt(document.getElementById('cardsPerPage').value,10),
          shuffleDefs: document.getElementById('shuffleDefs').checked,
          showCut: document.getElementById('showCut').checked,
          addNumber: document.getElementById('addNumber').checked
        };

        const built = buildPrintDocument(parsed.pairs, opts);
        const container = document.getElementById('printWrapper'); clear(container);
        container.appendChild(built);
        container.style.display = 'block';

        renderPreview(parsed.pairs, opts);
        document.getElementById('printBtn').disabled = false;
        // success message
        const ok = document.createElement('div'); ok.className='msg'; ok.textContent = 'Preview generated — check the on-screen previews. Click "Save as PDF (Print)" to create the PDF.';
        status.appendChild(ok);
      } catch(err){
        const status = document.getElementById('status'); clear(status);
        const e = document.createElement('div'); e.className='error'; e.textContent = 'Error generating preview: ' + (err && err.message ? err.message : String(err));
        status.appendChild(e);
        console.error(err);
      }
    }

    // Buttons
    document.getElementById('generateBtn').addEventListener('click', generate);
    document.getElementById('exampleBtn').addEventListener('click', ()=>{
      document.getElementById('inputArea').value = 'desert: a dry place\nriver: flowing body of water\nlake: a large body of water surrounded by land\nforest: a large area dominated by trees\nmountain: a high natural elevation\nisland: land surrounded by water\nvalley: low area between hills\ndune: a hill of sand formed by the wind';
      generate();
    });
    document.getElementById('clearBtn').addEventListener('click', ()=>{ document.getElementById('inputArea').value=''; generate(); });
    document.getElementById('printBtn').addEventListener('click', ()=>{
      const container = document.getElementById('printWrapper');
      if(!container.firstChild){ alert('No generated pages — click Generate first.'); return; }
      // Open print dialog; user should choose Save as PDF + A4
      window.print();
    });

    // Auto load example on first open
    document.getElementById('exampleBtn').click();
  </script>
</body>
</html>